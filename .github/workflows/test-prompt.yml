name: Test Prompt
on:
  workflow_dispatch:
jobs:
  ai-inference:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      - name: Set GITHUB_OUTPUT
        id: readme
        run: |
          if [ -f "test-results/junit-results.xml" ]; then
            {
              echo "README_CONTENT<<DELIMITER"
              cat test-results/junit-results.xml
              echo "DELIMITER"
            } >> $GITHUB_OUTPUT
          else
            echo "README_CONTENT=No se encontrÃ³ el archivo test-results/junit-results.xml" >> $GITHUB_OUTPUT
          fi
      - name: Run AI Inference Action
        id: inference
        uses: actions/ai-inference@v1
        with:
          max-tokens: 4000
          system-prompt: |
            Eres un experto en testing y desarrollo de software. Analiza los resultados de pruebas JUnit para proporcionar un resumen claro y Ãºtil.
          prompt: |
            Por favor, analiza el siguiente contenido del archivo junit-results.xml y proporciona un resumen conciso que incluya:

            1. **ðŸ“Š Resumen General**: NÃºmero total de pruebas, Ã©xitos, fallos y tiempo de ejecuciÃ³n
            2. **ðŸ§ª Pruebas Ejecutadas**: Lista de las pruebas principales que se ejecutaron
            3. **ðŸŽ¯ Funcionalidades Probadas**: QuÃ© aspectos del sistema se estÃ¡n validando
            4. **âš¡ Rendimiento**: Tiempos de ejecuciÃ³n y posibles optimizaciones
            5. **âœ… Estado del Proyecto**: Calidad general basada en los resultados
            6. **ðŸ”§ TecnologÃ­as Detectadas**: Frameworks y herramientas identificadas

            MantÃ©n el resumen en espaÃ±ol, usa emojis para hacerlo mÃ¡s visual y un tono profesional pero amigable.
            
            --- CONTENIDO DEL junit-results.xml ---
            ${{ steps.readme.outputs.README_CONTENT }}
            --- FIN DEL CONTENIDO ---
      - name: Write summary with AI response
        run: |
          echo "## ðŸ¤– AnÃ¡lisis AI de Resultados de Pruebas JUnit" >> $GITHUB_STEP_SUMMARY
          echo "${{ steps.inference.outputs.response }}" >> $GITHUB_STEP_SUMMARY
