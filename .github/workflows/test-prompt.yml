name: Test Prompt
on:
  workflow_dispatch:
    inputs:
      issue_number:
        description: 'N√∫mero de la issue de GitHub donde comentar el resumen'
        required: true
        type: number
jobs:
  ai-inference:
    runs-on: ubuntu-latest
    permissions:
      issues: write
      contents: read
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      - name: Set GITHUB_OUTPUT
        id: readme
        run: |
          if [ -f "test-results/junit-results.xml" ]; then
            {
              echo "README_CONTENT<<DELIMITER"
              cat test-results/junit-results.xml
              echo "DELIMITER"
            } >> $GITHUB_OUTPUT
          else
            echo "README_CONTENT=No se encontr√≥ el archivo test-results/junit-results.xml" >> $GITHUB_OUTPUT
          fi
      - name: Run AI Inference Action
        id: inference
        uses: actions/ai-inference@v1
        with:
          max-tokens: 4000
          model: "xai/grok-3"
          endpoint: "https://models.github.ai/inference"
          system-prompt: |
            Eres un experto en testing y desarrollo de software. Analiza los resultados de pruebas JUnit para proporcionar un resumen claro y √∫til.
          prompt: |
            Por favor, analiza el siguiente contenido del archivo junit-results.xml y proporciona un resumen conciso que incluya:

            1. **üìä Resumen General**: N√∫mero total de pruebas, √©xitos, fallos y tiempo de ejecuci√≥n
            2. **üß™ Pruebas Ejecutadas**: Lista de las pruebas principales que se ejecutaron
            3. **üéØ Funcionalidades Probadas**: Qu√© aspectos del sistema se est√°n validando
            4. **‚ö° Rendimiento**: Tiempos de ejecuci√≥n y posibles optimizaciones
            5. **‚úÖ Estado del Proyecto**: Calidad general basada en los resultados
            6. **üîß Tecnolog√≠as Detectadas**: Frameworks y herramientas identificadas

            Mant√©n el resumen en espa√±ol, usa emojis para hacerlo m√°s visual y un tono profesional pero amigable.
            
            --- CONTENIDO DEL junit-results.xml ---
            ${{ steps.readme.outputs.README_CONTENT }}
            --- FIN DEL CONTENIDO ---
      - name: Write summary with AI response
        run: |
          echo "## ü§ñ An√°lisis AI de Resultados de Pruebas JUnit" >> $GITHUB_STEP_SUMMARY
          echo "${{ steps.inference.outputs.response }}" >> $GITHUB_STEP_SUMMARY
      - name: Comment on GitHub Issue
        if: github.event.inputs.issue_number != ''
        uses: peter-evans/create-or-update-comment@v4
        with:
          issue-number: ${{ github.event.inputs.issue_number }}
          body: |
            ## ü§ñ An√°lisis AI de Resultados de Pruebas JUnit

            ${{ steps.inference.outputs.response }}

            ---
            *Generado autom√°ticamente por GitHub Actions - Workflow: ${{ github.workflow }} - Run: ${{ github.run_number }}*
